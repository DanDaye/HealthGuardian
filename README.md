# HealthGuardian
网络编程课程项目-云平台服务器APP客户端

# 1.引言
在物联网环境中，应用网关需要处理多个外围设备发送的数据并与其进行通信，这些通信请求可能会通过多个I/O句柄并发地到来（如一个设备对应一个句柄）。而且外围设备可能使用不同的通信协议，如TCP、UDP、串口通信协议等，即使使用同一种通信协议，还可能使用不同的端口。
对于采用TCP协议连接的设备，应用网关需要在指定的套接字句柄中监听新的连接。因为设备的通信请求同时从多个来源并发地到来，单线程服务器可能不能马上阻塞并从I/O句柄中读取数据。如果使用多线程的方式来实现应用网关，需要考虑几个缺点：第一，应用网关程序可能需要负责的并发控制机制；第二，在单处理器系统中可能会导致比较差的性能；第三，开发者需要投入大量精力于线程间的同步和防死锁措施中。
本课程设计以物联网应用网关为背景，提出使用事件驱动模型实现单线程并发的服务器模型并将其应用到多协议环境中，从而有效的解决当前服务器所存在的缺点，能够满足物联网环境中对服务器的需求。
#1.1 编写目的
本文档的编制是为了让用户和软件开发者双方对该开发软件的初始规定有一个共同的理解，定义所要开发的云平台服务器设计（以下简称系统）的开发目标，包括对功能的规定和性能的要求，指出预期的系统用户、系统的运行环境以及对用户操作的约定，使之成为整个项目中软件产品开发设计与实现的根据，也是软件产品的测试和验收的依据。
该说明书的读者为该项目的客户以及项目开发人员。
## 1.2 定义
定义关键词如下：
1.	HTTP：Hyper Text Transfer Protocol (超文本传输协议）
2.	HTML：Hyper Text Markup Language (超文本标记语言)
3.	DateBase：数据库
4.	IPO：Input & Process & Output(输入、处理、输出)
5.	C/S：客户端/服务端模式
6.	XML：扩展标记语言。
7.	SQL：结构化查询语言。
8.	P2P：Peer-to-Peer(对等联网)
9.	TCP/IP：传输控制协议，网际协议

# 2.任务概述
## 2.1 目标
云平台服务器设计需要实现一个服务器程序，一类APP以及一类模拟数据发送终端。模拟数据发送终端定期向服务器程序发送数据，服务器程序接受数据以后进行解析，处理，最后将处理结果推送到APP端。需要注意的是服务器要位于公网环境当中，同时保证模拟终端、服务器程序和APP之间的正常通信。
## 2.2 项目描述
本地服务器设计需要实现一个服务器程序，一类APP以及一类模拟数据发送终端。模拟数据发送终端定期向服务器程序发送数据，服务器程序接收数据以后进行解析，处理，最后将处理结果推送到APP端。由于是本地服务器，所以只需要保证服务器、模拟终端和APP在一个网络环境中可以通信即可。但是要求有2个以上的模拟终端同时向服务器发送消息，服务器可以向一个或多个APP端推送消息。
应用场景：
现有多台智能血压测量仪，每个患者可以绑定一个血压仪(通过血压仪唯一的设备ID与用户的唯一ID进行关联)，血压仪可以测量出使用者的高压、低压、心率，同时记录测量的时间。智能测量仪在测量并生成数据以后，它会通过网络将数据发送到指定的服务器。服务器接收到数据以后，会进行判断，根据高低压和心率得出测量者是否存在血压偏高或偏低的情况，并将这个情况打包成数据发送到各自对应的APP端。APP端要能够接收到服务器发送的数据，并解析显示到相关的界面中。服务器要具有数据存储功能，可以对每一个用户的信息进行管理，同时将用户对应的血压仪上传的数据进行管理(CURD)。不同的用户可以通过APP端的“社区”功能进行通信，包括端到端的文字交流，语音或者视频交流，以及所有用户共享的公共消息的编辑。
在本次课程设计中，我们的模拟终端程序用来虚拟智能血压测量仪，它按照固定的格式定期向指定的服务器发送随机生成的高低压、心率和测量时间信息。服务器程序用来接收模拟终端发送的数据，并解析处理，根据既定的规则给出判断结果，即存在高血压或低血压，亦或正常，同时服务器需要将这个最终结果打包到数据包中发送到APP端。APP端需要接收服务器发送的数据，并解析，将结果以文本或图形化界面的形式展示出来。

## 2.3 用户特点
云平台服务器设计的用户大概分为3类：
### 2.3.1 服务器管理员
对系统的用户健康数据进行CRUD操作，对用户的个人信息进行维护。

### 2.3.2 App用户 
App用户与终端用户进行绑定，终端用户的实时健康数据会通过服务器发送到App用户手中，同时App用户还可以通过App的社区功能与其他的App用户进行通信。
### 2.3.3 终端用户
终端用户将会通过终端设备将个人健康数据发送到服务器端。

# 3.需求规定
## 3.1功能需求清单

模块图示： 

## 3.2功能需求优先级
云平台服务器设计需要实现一个服务器程序，一类APP以及一类模拟数据发送终端。模拟数据发送终端定期向服务器程序发送数据，服务器程序接受数据以后进行解析，处理，最后将处理结果推送到APP端。需要注意的是服务器要位于公网环境当中，同时保证模拟终端、服务器程序和APP之间的正常通信。
序号
编号
名称
描述
优先级
1.	wcs-1	用户注册	用户通过注册在网站上申请一个唯一的帐号 高
2.	wcs-2	用户登录	用户使用自己注册的帐号进入APP	高
3.	wcs-3	绑定终端	用户通过App绑定终端用户	高
4.	wcs-4	社区功能	用户通过APP与其他用户进行通信	中
5.	wcs-5	公告功能	用户接收系统发出的公告	中
6.	wcs-6	维护健康数据	管理员通过网站对终端用户的健康数据进行维护	中
7.	wcs-7	维护用户信息	管理员对用户的个人信息进行维护	高

## 3.3功能需求描述
### 3.3.1注册登录
#### 3.3.1.1用户注册

基本流程：
用户需提供其用户ID、用户名、密码及确认密码、验证码 。用户名必须是系统尚未使用的，用户输入以上信息，然后单击“提交”按钮新建用户。系统收到用户提供的数据并检验其有效性后。
分支流程：
1.	如果用户没有输入用户ID，系统将显示一条错误消息，指出错误并提示用户输入用户ID;
2.	如果用户输入的用户名已存在，系统将显示一条错误消息，指出错误并提示用户重新输入用户名；
3.	如果用户输入的密码位数不符合系统规定范围，系统将显示一条错误消息，指出错误并提示用户输入的密码；
4.	如果用户两次输入的密码不同，系统将显示一条错误消息，指出错误并提示用户输入密码及确认密码；
5.	如果用户未完整填写基本信息页面必填字段，系统将显示一条错误消息，指出错误并提示用户输入必填字段；
数据需求：
1.	用户ID
2.	用户名
3.	密码
4.	确认密码
#### 3.3.1.2用户登录

基本流程：
用户输入用户ID、密码，然后点击登录，用户登录App。
分支流程：
1.	如果用户没有输入用户名，系统将显示一条错误消息，指出错误并提示用户输入用户名;
2.	如果用户没有输入密码，系统将显示一条错误消息，指出错误并提示用户输入密码;
3.	如果用户输入的用户名未被注册，系统提示用户输入的用户名不存在。
4.	如果用户输入的用户名密码错误，系统将显示一条错误消息，指出错误并提示用户输入正确的用户名和密码;
数据需求：
1.	用户ID
2.	密码
### 3.3.2模拟终端
模拟器模拟智能测量仪，模拟生成用户血压数据，同时记录时间。定时通过网络将数据发送到指定的服务器，以达到APP和测量仪同步效果。模拟器应和用户账号进行绑定，一个模拟器对应一个指定用户。
基本流程：
1.	模拟器绑定指定用户账号；
2.	模拟器模拟生成用户血压数据，记录时间；
3.	模拟器定时发送数据到指定服务器；
分支流程：
模拟器绑定用户账号失败，重新绑定用户账号
流程图：

数据需求：
用户账号
服务器地址
模块图示：


### 3.3.3.APP端
用户可以通过智能血压测量APP查看自己的血压情况，还能通过APP的“社区”功能进行通信，例如，用户间互发文字、语言或者视频消息。同时，用户可以通过APP接收到公告信息。APP能够接收服务器端的数据并进行解析处理，显示给用户。用户可以通过智能血压测量APP查看自己的血压情况，还能通过APP的“社区”功能进行通信，例如，用户间互发文字、语言或者视频消息。同时，用户可以通过APP接收到公告信息。APP能够接收服务器端的数据并进行解析处理，显示给用户。

#### 3.3.3.1.查看血压情况
基本流程：
用户进入智能血压测量APP，APP接收服务器发送的数据，解析并转换成文字以及图形的形式显示给用户。
分支流程：
a．	如果用户网络环境过差，导致系统接收数据失败，系统将提示用户刷新
b．	如果用户血压数据超过或低于既定范围，系统将提示用户血压不正常
#### 3.3.3.2 用户间通信
基本流程：
用户点击APP菜单的“社区”选项，进入社区成员列表。用户通过点击选择其它用户建立通信。

##### 文字通信
基本流程：
   用户输入相应文字，并点击发送按钮，系统将用户输入文字发送给与该用户通信的另一个用户。
分支流程：
   如果文字消息发送失败，系统将提示用户重新发送消息。

##### 语音通信（暂定）
基本流程：
用户点击“语音”按钮的同时说出想发送的语音消息，然后松开“语音”按钮，系统将用户输入语音消息发送给与该用户通信的另一个用户。
分支流程：
如果语音消息发送失败，系统将提示用户重新发送消息。

##### 视频通信（暂定）
基本流程：
用户点击“视频通信”按钮，系统将提示与该用户通信的另一个用户是否接受视频通信，另一用户点击确认建立视频通话连接。
分支流程：
a. 如果视频连接建立失败，系统将提示用户重新建立连接。
b.如果用户拒绝接受视频通话的请求，系统给出提示并关闭视频通话连接界面。
#### 3.3.3.3 接收公告
基本流程：
系统发送公告给所有用户，用户打开App，APP显示系统公告信息。
### 3.3.4服务器端
   服务器从模拟器端接收健康数据，进行解析处理后生成健康报告并推送至APP端。管理员在服务器端对用户进行管理，如增加、删除用户和修改用户信息等。同时，服务器端可接收发送APP中的聊天信息。服务器要位于公网环境中，保证模拟终端、服务器程序和APP之间的正常通信。
基本流程：
1.	服务器接收相关健康数据；
2.	服务器解析处理数据并生成健康报告；
3.	服务器推送健康报告至APP端。

数据需求：APP端地址	模拟器地址

模块图示：

# 4.运行要求
## 4.1通信协议要求
1.作为多协议服务器，课程要求实现TCP和UDP两类通信协议。即APP或模拟程序可以选择任意一种方式与服务器交互。
2.在模拟设备与服务器的交互过程中，需要按照如下的应用层协议进行交互：
包头	类型	ID	高压	低压	心率	时间	包尾
NH	00	000	000	000	000	00000000000000	NT
包头标定数据包的开始，用于告知服务器，在获取到NH以后，开始解析后面的字符串，包尾标定数据包的结束，获取到NT以后停止解析。
类型标定了数据包的类型，项目中默认全部为00，表述仪器测量值类型。
ID标定了这条数据是由具体的哪个血压计产生的，ID和血压计的唯一设备编号相对应，共计三个字符
高压、低压和心率分别由3个字符表示。
时间由14个字符表示，年4位，月2位，日2位，时2位，分2位，秒2位。
模拟终端需要按照诸如NH0010111406406520170401132533NT这样的格式向服务器发送数据。这条数据的含义是编号为101的设备在2017年4月1日13点25分33秒测量了一组数据，高压为114，低压为064，心率为065，这条数据包的数据类型为仪器测量值类型。
3.服务器与APP的交互按照以下应用层协议进行：
包头	类型	状态	包尾	
PH	01	00	PT
类型默认都为01，即服务器结果反馈。
状态有三个值可选：00正常，01高血压，10低血压
1.服务器需要按照诸如PH0101PT这种格式向APP发送数据。这条数据的含义是具有高血压的症状，数据包类型为服务器结果发聩类型。
## 4.2 测试要求
    本课程设计的最终目标是设计并实现一个多协议服务器，在该服务器中采用事件驱动模型实现单线程并发，同时通过对TCP、UDP通信协议进行模块化封装，实现对服务器通信协议的动态配置。最终实现的服务器能够通过多种协议的并发测试。
服务器详细测试场景如下：
   在测试中开启1个TCP模拟设备、1个UDP模拟设备，每隔一段时间发送一次数据给服务器。若服务器能同时处理这些模拟设备发送的消息，并将处理结果推送到APP端，则该服务器满足本课程设计的基本要求。
## 4.3 接口
1.TCP/IP,HTTP 1.1,套结字 Sockets
2.终端与服务器之间的数据传输接口
3.App与服务器之间的接口
4.服务器与数据库之间的操作接口

## 4.4 数据管理能力要求
1.数据备份和恢复工具
2.数据访问控制措施 
3.用户的身份鉴别与权限控制 
4.数据机密性保护措施，如密文存储 
5.数据完整性保护措施 
6.防止非法软盘拷贝和硬盘启动 
7.备份数据的安全保护
## 4.5 故障处理要求
1.服务器的故障将导致帮助文件的内容不可访问，故建议服务器应采用备份恢复的措施；数据库的故障将导致某些功能的无效，但不影响帮助文件的查询。
2.当数据库损坏是能够有备份数据快速恢复，使得数据不被毁坏。
3.服务器崩溃时能重起动操作系统使得该系统能快速恢复。
4.服务器的故障将导致帮助文件的内容不可访问，故建议服务器应采用备份恢复的措施。数据库的故障将导致某些功能的无效，但不影响帮助文件的查询。
5.当用户由于操作失误导致系统崩溃，重启机器即可恢复。
6.当用户由于操作失误删除数据库时，需要系统维护人员重新导入备份数据库。
7.通过设置级别权限来增强安全性，对外部网络免疫，对来自内部的攻击则无能为力。
## 4.6 网络安全性能
   通过设置级别权限来增强安全性，记录用户的任何对数据库的操作。防止黒客非法入侵，使用Internet公用网络端口。 
用户密码过如简单或被窃，应快速告知管理员注销该用户。
## 4.7 灾难性事件应急措施 
1.数据备份 
2.备份数据的安全保护 
3.恢复工具 

